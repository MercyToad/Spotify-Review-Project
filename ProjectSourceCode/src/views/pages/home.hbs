{{!--
  Home page template
  - Shows trending songs, user recent reviews, and a right-hand sidebar for user's highest rated songs.
  - Uses card components (content-card) and the grid `home-grid-layout` to arrange content.
  - This file is rendered into `main.hbs` via the layout system.
--}}

<div class="home-grid-layout">
  <main class="main-content">
    
    <section class="content-section home-trending-songs">
      <h2>Trending Songs</h2>
      <div class="content-grid four-col">
        <div class="content-card" style="position: relative; cursor: pointer;">
          <a href="/song/1" style="text-decoration: none; color: inherit; display: block;">
            <img src="https://placehold.co/300x300/f97316/white?text=AIW" alt="As It Was Album Art">
            <h3>As It Was</h3>
            <p>Harry Styles</p>
            <div class="card-rating" style="display: flex; align-items: center; gap: 0.5rem; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path></svg>
                {{#with (lookup homeSongStats "1")}}
                  <span>{{averageRating}}</span>
                  <span class="review-count">{{reviewCount}} reviews</span>
                {{else}}
                  <span>4.7</span>
                  <span class="review-count">5 reviews</span>
                {{/with}}
              </div>
              <a href="/song/1#review" class="add-review-btn-inline" title="Add Review" onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/song/1#review';">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </a>
            </div>
          </a>
        </div>

        <div class="content-card" style="position: relative; cursor: pointer;">
          <a href="/song/2" style="text-decoration: none; color: inherit; display: block;">
            <img src="https://placehold.co/300x300/f43f5e/white?text=BL" alt="Blinding Lights Art">
            <h3>Blinding Lights</h3>
            <p>The Weeknd</p>
            <div class="card-rating" style="display: flex; align-items: center; gap: 0.5rem; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path></svg>
                {{#with (lookup homeSongStats "2")}}
                  <span>{{averageRating}}</span>
                  <span class="review-count">{{reviewCount}} reviews</span>
                {{else}}
                  <span>5.0</span>
                  <span class="review-count">5 reviews</span>
                {{/with}}
              </div>
              <a href="/song/2#review" class="add-review-btn-inline" title="Add Review" onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/song/2#review';">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </a>
            </div>
          </a>
        </div>

        <div class="content-card" style="position: relative; cursor: pointer;">
          <a href="/song/3" style="text-decoration: none; color: inherit; display: block;">
            <img src="https://placehold.co/300x300/8b5cf6/white?text=LV" alt="Levitating Art">
            <h3>Levitating</h3>
            <p>Dua Lipa</p>
            <div class="card-rating" style="display: flex; align-items: center; gap: 0.5rem; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path></svg>
                {{#with (lookup homeSongStats "3")}}
                  <span>{{averageRating}}</span>
                  <span class="review-count">{{reviewCount}} reviews</span>
                {{else}}
                  <span>4.5</span>
                  <span class="review-count">4 reviews</span>
                {{/with}}
              </div>
              <a href="/song/3#review" class="add-review-btn-inline" title="Add Review" onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/song/3#review';">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </a>
            </div>
          </a>
        </div>

        <div class="content-card" style="position: relative; cursor: pointer;">
          <a href="/song/4" style="text-decoration: none; color: inherit; display: block;">
            <img src="https://placehold.co/300x300/eab308/white?text=FL" alt="Flowers Art">
            <h3>Flowers</h3>
            <p>Miley Cyrus</p>
            <div class="card-rating" style="display: flex; align-items: center; gap: 0.5rem; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path></svg>
                {{#with (lookup homeSongStats "4")}}
                  <span>{{averageRating}}</span>
                  <span class="review-count">{{reviewCount}} reviews</span>
                {{else}}
                  <span>4.6</span>
                  <span class="review-count">5 reviews</span>
                {{/with}}
              </div>
              <a href="/song/4#review" class="add-review-btn-inline" title="Add Review" onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/song/4#review';">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </a>
            </div>
          </a>
        </div>

        <div class="content-card" style="position: relative; cursor: pointer;">
          <a href="/song/5" style="text-decoration: none; color: inherit; display: block;">
            <img src="https://placehold.co/300x300/10b981/white?text=KB" alt="Kill Bill Art">
            <h3>Kill Bill</h3>
            <p>SZA</p>
            <div class="card-rating" style="display: flex; align-items: center; gap: 0.5rem; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path></svg>
                {{#with (lookup homeSongStats "5")}}
                  <span>{{averageRating}}</span>
                  <span class="review-count">{{reviewCount}} reviews</span>
                {{else}}
                  <span>4.9</span>
                  <span class="review-count">5 reviews</span>
                {{/with}}
              </div>
              <a href="/song/5#review" class="add-review-btn-inline" title="Add Review" onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/song/5#review';">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </a>
            </div>
          </a>
        </div>

        <div class="content-card" style="position: relative; cursor: pointer;">
          <a href="/song/6" style="text-decoration: none; color: inherit; display: block;">
            <img src="https://placehold.co/300x300/0284c7/white?text=AH" alt="After Hours Art">
            <h3>After Hours</h3>
            <p>The Weeknd</p>
            <div class="card-rating" style="display: flex; align-items: center; gap: 0.5rem; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path></svg>
                {{#with (lookup homeSongStats "6")}}
                  <span>{{averageRating}}</span>
                  <span class="review-count">{{reviewCount}} reviews</span>
                {{else}}
                  <span>4.8</span>
                  <span class="review-count">5 reviews</span>
                {{/with}}
              </div>
              <a href="/song/6#review" class="add-review-btn-inline" title="Add Review" onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/song/6#review';">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </a>
            </div>
          </a>
        </div>
      </div>
    </section>

  </main>

  <aside class="sidebar-content">
    
    <section class="sidebar-widget glass-card">
      <a href="/my-reviews" style="text-decoration: none; color: inherit;">
        <h3 style="cursor: pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--spotify-green)'" onmouseout="this.style.color='var(--foreground)'">Your Highest Rated</h3>
      </a>
      {{#if highestRated}}
        <ul class="widget-list">
          {{#each highestRated}}
          <a href="/song/{{this.songId}}" style="text-decoration: none; color: inherit;">
          <li style="cursor: pointer;">
            <img src="{{this.artworkUrl}}" alt="Album Art">
            <div class="widget-list-info">
              <span>{{this.title}}</span>
              <span>{{this.artist}}</span>
            </div>
            <div class="widget-list-rating">
              <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path></svg>
              <span>{{this.rating}}</span>
            </div>
          </li>
          </a>
          {{/each}}
        </ul>
      {{else}}
        <p class="section-subtitle" style="color: var(--muted-foreground);">No reviews yet</p>
      {{/if}}
    </section>

  </aside>
</div>

<section class="content-section home-recent-reviews">
  <h2>Your Recent Reviews</h2>
  {{#if recentReviews}}
    <div class="content-grid four-col" id="recentReviewsContainer">
      {{#each recentReviews}}
      <a href="/song/{{this.songId}}" class="recent-review-card-link" data-song-id="{{this.songId}}" style="text-decoration: none; color: inherit; display: block; height: 100%;">
        <div class="review-card-long glass-card" style="cursor: pointer; height: 100%;">
          <div class="review-card-body" style="padding: 1rem; display: flex; flex-direction: column;">
            <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0.75rem; flex-shrink: 0;">
              <div style="flex: 1; min-width: 0;">
                <p class="review-song-title" style="margin: 0 0 0.25rem 0; font-weight: 600;">{{this.title}}</p>
                <p class="review-song-artist" style="margin: 0; color: var(--muted-foreground);">{{this.artist}}</p>
              </div>
              <div style="display: flex; align-items: center; gap: 0.15rem; flex-shrink: 0; margin-left: 1rem;">
                {{#times this.rating}}
                  <svg class="star-icon" fill="var(--star)" viewBox="0 0 20 20" style="width: 0.875rem; height: 0.875rem;">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path>
                  </svg>
                {{/times}}
                {{#times (subtract 5 this.rating)}}
                  <svg class="star-icon" fill="var(--muted-foreground)" viewBox="0 0 20 20" style="width: 0.875rem; height: 0.875rem; opacity: 0.3;">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.97a1 1 0 00.95.69h4.172c.969 0 1.371 1.24.588 1.81l-3.376 2.45a1 1 0 00-.364 1.118l1.286 3.97c.3.921-.755 1.688-1.54 1.118l-3.376-2.45a1 1 0 00-1.175 0l-3.376 2.45c-.784.57-1.838-.197-1.54-1.118l1.286-3.97a1 1 0 00-.364-1.118L2.24 9.397c-.783-.57-.38-1.81.588-1.81h4.172a1 1 0 00.95-.69l1.286-3.97z"></path>
                  </svg>
                {{/times}}
              </div>
            </div>
            <p class="review-text" style="margin: 0; color: var(--muted-foreground);">"{{this.reviewText}}"</p>
          </div>
        </div>
      </a>
      {{/each}}
    </div>
  {{else}}
    <p class="section-subtitle" style="color: var(--muted-foreground);">No reviews yet</p>
  {{/if}}
</section>

<script>
  // Filter out deleted reviews on page load
  document.addEventListener('DOMContentLoaded', function() {
    const deletedReviews = JSON.parse(localStorage.getItem('deletedReviews') || '[]');
    const reviewCards = document.querySelectorAll('.recent-review-card-link');
    
    reviewCards.forEach(card => {
      const songId = card.getAttribute('data-song-id');
      if (deletedReviews.includes(songId)) {
        card.style.display = 'none';
      }
    });
  });
</script>