{{!--
  My Reviews section
  - This section contains: a header, a button to add a review, a client-side form (hidden by default),
  - and a list of existing reviews. The client-side code in `script.js` handles toggling the form
  - and rendering new reviews using the Handlebars template included below.
--}}

<section class="content-section" id="myReviewsSection" data-username="{{username}}">
  <div class="header-row" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;">
    <div>
      <h2>My Reviews</h2>
      <p class="section-subtitle">Write and view your song reviews</p>
    </div>
    <div>
      <button id="addReviewBtn" class="btn-primary" aria-label="Add review">+ Add Review</button>
    </div>
  </div>

  <!-- Review form (hidden by default) -->
  <div id="reviewFormContainer" class="review-form" style="{{display}} margin-top:1rem;">
    <form id="search-form2">
      <div class="form-group search-container">
        <label for="songTitle">Song Title</label>
        <input id="search-input2" class="form-input" placeholder="Enter song title"  value="{{song_name}}" required />
        <div id="search-results-dropdown2" class="profile-menu active dropdown-content" style="display:none">

        </div>
      </div>
    </form>
    <form id="reviewForm" action="/review" method="POST">
      <input type="hidden" id="song-id-input" name="song_id" value="{{song_id}}"> <!-- hidden input so i can send the id too so its not like a triple query-->
      <input type="hidden" id="songTitle" name="songTitle" value="{{song_name}}"/>
      <div class="form-group">
        <label for="reviewText">Review</label>
        <textarea id="reviewText" name="reviewText" class="form-input" placeholder="Write your review" rows="4" required></textarea>
      </div>
      <div class="form-group">
        <span onclick="fillStars(1)" class="review-star-empty star">★</span>
        <span onclick="fillStars(2)" class="review-star-empty star">★</span>
        <span onclick="fillStars(3)" class="review-star-empty star">★</span>
        <span onclick="fillStars(4)" class="review-star-empty star">★</span>
        <span onclick="fillStars(5)" class="review-star-empty star">★</span>
        <input type="hidden" id="star-input" name="stars">
    </div>
    <div style="display:flex;gap:0.5rem;">
        <button type="submit" class="btn-primary">Add</button>
        <button type="button" id="cancelReviewBtn" class="btn-secondary">Cancel</button>
      </div>
    </form>
    <script> // note: star output adapted from https://www.geeksforgeeks.org/javascript/star-rating-using-html-css-and-javascript/
      let stars = document.getElementsByClassName("star");
      let input = document.getElementById("star-input");

      function fillStars(n) {
        console.log("hello stars");
        for (let j = 0; j < 5; j++) {
          stars[j].className = ".review-star-empty star";
        }
        for (let i = 0; i < n; i++) {
          stars[i].className = "review-star-selected star";
        }
        input.value = n;
      }
    </script>
  </div>

  <!-- Reviews list -->
  <div id="reviewsList" style="margin-top:1.5rem; display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:1rem;">
    {{#if reviews}}
      {{#each reviews}}
        <div class="review-card-long">
          <div class="review-card-header">
            <img class="review-user-avatar" src="https://placehold.co/40x40/22c55e/white?text={{usernameChar}}" alt="Avatar">
            <div class="review-user-info">
              <span>{{username}}</span>
              <span class="review-timestamp">{{createdAt}}</span>
            </div>
            <div class="review-user-rating">&nbsp;</div>
          </div>
          <div class="review-card-body">
            <p class="review-song-title">{{songTitle}}</p>
            <p class="review-text">{{reviewText}}</p>
          </div>
        </div>
      {{/each}}
    {{/if}}
  </div>

  <!-- Client-side Handlebars template for rendering a review -->
  <script id="review-template" type="text/x-handlebars-template">
    <div class="review-card-long">
      <div class="review-card-header">
        <img class="review-user-avatar" src="https://placehold.co/40x40/22c55e/white?text={{usernameChar}}" alt="Avatar">
        <div class="review-user-info">
          <span>{{username}}</span>
          <span class="review-timestamp">{{createdAt}}</span>
        </div>
        <div class="review-user-rating">&nbsp;</div>
      </div>
      <div class="review-card-body">
        <p class="review-song-title">{{songTitle}}</p>
        <p class="review-text">{{reviewText}}</p>
      </div>
    </div>
  </script>

</section>
